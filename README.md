# Онлайн-кинотеатр: Сервис профилей пользователей

## Описание проекта

Сервис управления профилями пользователей онлайн-кинотеатра. Позволяет пользователям создавать личные профили, добавлять
фильмы в избранное, оставлять рецензии и выставлять рейтинги фильмам.

## Архитектура проекта

Проект построен на микросервисной архитектуре и включает следующие сервисы:

### Основные сервисы:

- **Auth Service** (порт 8082) - Аутентификация и авторизация пользователей
- **Profile Service** (порт 8084) - Управление профилями пользователей
- **Movie Service** (порт 8085) - Информация о фильмах
- **Admin Service** (порт 8080) - Административная панель управления
- **Rate Limit Service** (порт 8083) - Ограничение количества запросов

### Инфраструктурные сервисы:

- **Nginx** - Обратный прокси-сервер (порт 80)
- **PostgreSQL** - Основная база данных (порт 5432)
- **Redis** - Кэширование и хранение сессий (порт 6379)
- **MongoDB** - Хранение пользовательского контента (порт 27019)
- **Elasticsearch** - Полнотекстовый поиск и логирование (порты 9200, 9400)
- **Logstash** - Сбор и обработка логов (порт 5044)
- **Kibana** - Визуализация логов (порт 5601)
- **Jaeger** - Распределенная трассировка (порт 16686)

## Основной функционал

### Профили пользователей:

- Создание и управление профилями
- Хранение персональных данных (ФИО, телефон)
- Просмотр публичных профилей других пользователей

### Работа с фильмами:

- Добавление фильмов в избранное
- Выставление рейтингов фильмам
- Написание рецензий
- Просмотр отзывов и рейтингов других пользователей

### Административная часть:

- Управление пользователями и их профилями
- Система ролей и прав доступа
- Модерация контента

## Технический стек

### Бэкенд:

- Python 3.11
- FastAPI
- Django (админка)
- SQLAlchemy
- Alembic (миграции)

### Базы данных и хранилища:

- PostgreSQL
- Redis
- MongoDB
- Elasticsearch

### Мониторинг и логирование:

- ELK Stack (Elasticsearch, Logstash, Kibana)
- Jaeger
- Sentry

### Инфраструктура:

- Docker
- Docker Compose
- Nginx

## Установка и запуск

### Предварительные требования:

- Docker
- Docker Compose
- Git

### Порядок установки:

1. Клонировать репозиторий:

```bash
git clone git@github.com:stybayev/graduate_work.git
cd graduate_work
```

2. Создать файл конфигурации:

```bash
cp .env.example .env
```

3. Настроить переменные окружения в файле `.env`

4. Запустить проект:

```bash
docker-compose -f docker-compose.dev.yml up -d
```

После запуска в админ-панели django автоматически создается суперпользователь со следующими учетными данными:

```bash
логин: admin
пароль: password
```

### Проверка работоспособности:

- Auth Service: http://localhost:8082/api/auth/openapi
- Profile Service: http://localhost:8084/api/profile/openapi
- Movie Service: http://localhost:8085/api/movie/openapi
- Admin Panel: http://localhost:8080/admin
- Kibana: http://localhost:5601
- Jaeger UI: http://localhost:16686

## API Endpoints

### Profile Service

- `POST /api/v1/profiles/` - Создание профиля
- `GET /api/v1/profiles/me` - Получение своего профиля
- `GET /api/v1/profiles/users/{user_id}` - Получение публичного профиля
- `PUT /api/v1/profiles/{user_id}` - Обновление профиля
- `PATCH /api/v1/profiles/{user_id}` - Частичное обновление профиля
- `DELETE /api/v1/profiles/{user_id}` - Удаление профиля

### Bookmarks

- `POST /api/v1/bookmarks/bookmark/` - Добавление фильма в закладки
- `GET /api/v1/bookmarks/bookmarks/` - Получение списка закладок
- `DELETE /api/v1/bookmarks/bookmark/{movie_id}` - Удаление из закладок
- `PATCH /api/v1/bookmarks/bookmark/{movie_id}` - Обновление закладки

### Ratings

- `POST /api/v1/ratings/rating/` - Создание рейтинга
- `GET /api/v1/ratings/movies/{movie_id}/ratings/` - Получение рейтингов фильма
- `GET /api/v1/ratings/movies/{movie_id}/average/` - Средний рейтинг фильма
- `PUT /api/v1/ratings/rating/{movie_id}` - Обновление рейтинга
- `DELETE /api/v1/ratings/rating/{movie_id}` - Удаление рейтинга

### Reviews

- `POST /api/v1/reviews/` - Создание рецензии
- `GET /api/v1/reviews/movie/{movie_id}` - Получение рецензий фильма
- `GET /api/v1/reviews/user` - Получение рецензий пользователя
- `PUT /api/v1/reviews/{movie_id}` - Обновление рецензии
- `DELETE /api/v1/reviews/{movie_id}` - Удаление рецензии

## Безопасность

### Аутентификация

- JWT-токены для авторизации
- OAuth2 интеграция с Яндекс
- Возможность двухфакторной аутентификации

### Защита данных

- Шифрование чувствительных данных
- Rate limiting для API endpoints
- Логирование действий пользователей

## Мониторинг и логирование

### Логирование

- Централизованный сбор логов через ELK Stack
- Структурированные логи в JSON формате
- Отдельные индексы для разных сервисов

### Трейсинг

- Распределенная трассировка через Jaeger
- Отслеживание межсервисных вызовов
- Мониторинг производительности

### Метрики

- Сбор метрик сервисов
- Мониторинг состояния баз данных
- Алерты при критических событиях

## Дополнительная информация

### Разработка

- Следование принципам REST API
- Документация API в формате OpenAPI
- Версионирование API
